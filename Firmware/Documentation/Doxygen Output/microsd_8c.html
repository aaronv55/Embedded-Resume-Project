<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded Resume Project Code Documentation: Firmware/Embedded Resume Files/microsd.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Favicon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded Resume Project Code Documentation
   &#160;<span id="projectnumber">Version 1.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('microsd_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">microsd.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file contains drivers for interacting with an external microSD card through SPI.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="microsd_8h_source.html">microsd.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structt__sd__file.html">t_sd_file</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ac9569e2a141c90182d9ef36d91af5970"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="microsd_8c.html#abaf7619c551d1fc468c7ab87526164a4">e_sd_file_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#ac9569e2a141c90182d9ef36d91af5970">e_sd_file_type</a></td></tr>
<tr class="separator:ac9569e2a141c90182d9ef36d91af5970"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab289a99c10567325e1eee455dba68dbd"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structt__sd__file.html">t_sd_file</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#ab289a99c10567325e1eee455dba68dbd">t_sd_file</a></td></tr>
<tr class="separator:ab289a99c10567325e1eee455dba68dbd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:abaf7619c551d1fc468c7ab87526164a4"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#abaf7619c551d1fc468c7ab87526164a4">e_sd_file_type</a> { <a class="el" href="microsd_8c.html#abaf7619c551d1fc468c7ab87526164a4aa1b04f3fe4c0de5a3dfbbbb0d80e5d67">bmp_file</a>
, <a class="el" href="microsd_8c.html#abaf7619c551d1fc468c7ab87526164a4a1b6d82aa746d57bebea9a2ab69b07aef">wav_file</a>
, <a class="el" href="microsd_8c.html#abaf7619c551d1fc468c7ab87526164a4aa4ad49413733f1020f51fc7e828af1a8">txt_file</a>
 }</td></tr>
<tr class="separator:abaf7619c551d1fc468c7ab87526164a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a67d8e6949bffdbb7b8909aecabcbddc7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a67d8e6949bffdbb7b8909aecabcbddc7">sd_send_command</a> (uint8_t command, uint32_t data)</td></tr>
<tr class="memdesc:a67d8e6949bffdbb7b8909aecabcbddc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends 5-byte command/data to the SD card.  <a href="microsd_8c.html#a67d8e6949bffdbb7b8909aecabcbddc7">More...</a><br /></td></tr>
<tr class="separator:a67d8e6949bffdbb7b8909aecabcbddc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a82443f01cf78e7ea902f201f893e82"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a4a82443f01cf78e7ea902f201f893e82">sd_receive_r1_response</a> (void)</td></tr>
<tr class="memdesc:a4a82443f01cf78e7ea902f201f893e82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Recieves R1 response from SD card.  <a href="microsd_8c.html#a4a82443f01cf78e7ea902f201f893e82">More...</a><br /></td></tr>
<tr class="separator:a4a82443f01cf78e7ea902f201f893e82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b1796af1b16e2ed0dc306a96a714a5a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a8b1796af1b16e2ed0dc306a96a714a5a">sd_receive_r3_response</a> (uint8_t *r3_response)</td></tr>
<tr class="memdesc:a8b1796af1b16e2ed0dc306a96a714a5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receives R3 response from SD card.  <a href="microsd_8c.html#a8b1796af1b16e2ed0dc306a96a714a5a">More...</a><br /></td></tr>
<tr class="separator:a8b1796af1b16e2ed0dc306a96a714a5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac86c235f84f8f94abf9ad7e737e76f1a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#ac86c235f84f8f94abf9ad7e737e76f1a">sd_receive_r7_response</a> (uint8_t *r7_response)</td></tr>
<tr class="memdesc:ac86c235f84f8f94abf9ad7e737e76f1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receives R7 response from SD card.  <a href="microsd_8c.html#ac86c235f84f8f94abf9ad7e737e76f1a">More...</a><br /></td></tr>
<tr class="separator:ac86c235f84f8f94abf9ad7e737e76f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06ccd3cb71dd16d5b308643aaf4c88d8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a06ccd3cb71dd16d5b308643aaf4c88d8">sd_send_app_command</a> (void)</td></tr>
<tr class="memdesc:a06ccd3cb71dd16d5b308643aaf4c88d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tell the SD card that the next command will be an application specific command.  <a href="microsd_8c.html#a06ccd3cb71dd16d5b308643aaf4c88d8">More...</a><br /></td></tr>
<tr class="separator:a06ccd3cb71dd16d5b308643aaf4c88d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad718d3881a88d048f4a1f6457d2bf8b4"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#ad718d3881a88d048f4a1f6457d2bf8b4">sd_idle_sequence</a> (void)</td></tr>
<tr class="memdesc:ad718d3881a88d048f4a1f6457d2bf8b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Puts SD card into idle state.  <a href="microsd_8c.html#ad718d3881a88d048f4a1f6457d2bf8b4">More...</a><br /></td></tr>
<tr class="separator:ad718d3881a88d048f4a1f6457d2bf8b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66c0ff809386256d45eab52c8fe5fefb"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a66c0ff809386256d45eab52c8fe5fefb">sd_interface_condition_sequence</a> (void)</td></tr>
<tr class="memdesc:a66c0ff809386256d45eab52c8fe5fefb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if SD is 2.0 and sets voltage to 3.3v.  <a href="microsd_8c.html#a66c0ff809386256d45eab52c8fe5fefb">More...</a><br /></td></tr>
<tr class="separator:a66c0ff809386256d45eab52c8fe5fefb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a4b8de004d39a5a80924d7bd69154be"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a1a4b8de004d39a5a80924d7bd69154be">sd_read_ocr</a> (void)</td></tr>
<tr class="memdesc:a1a4b8de004d39a5a80924d7bd69154be"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if SD card is powered on, voltage is acceptable and.  <a href="microsd_8c.html#a1a4b8de004d39a5a80924d7bd69154be">More...</a><br /></td></tr>
<tr class="separator:a1a4b8de004d39a5a80924d7bd69154be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ed5401fcbcc2c66013ea9aefdbd4a16"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a5ed5401fcbcc2c66013ea9aefdbd4a16">sd_send_operating_condition</a> (void)</td></tr>
<tr class="memdesc:a5ed5401fcbcc2c66013ea9aefdbd4a16"><td class="mdescLeft">&#160;</td><td class="mdescRight">Activates the SD card initialization process.  <a href="microsd_8c.html#a5ed5401fcbcc2c66013ea9aefdbd4a16">More...</a><br /></td></tr>
<tr class="separator:a5ed5401fcbcc2c66013ea9aefdbd4a16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad83001a0c814f5477acd51fba80de713"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#ad83001a0c814f5477acd51fba80de713">sd_cmd24_termination_sequence</a> (void)</td></tr>
<tr class="memdesc:ad83001a0c814f5477acd51fba80de713"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for SD to return correct responses after writing a single block.  <a href="microsd_8c.html#ad83001a0c814f5477acd51fba80de713">More...</a><br /></td></tr>
<tr class="separator:ad83001a0c814f5477acd51fba80de713"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5079c838aa341e66a21a372235da54cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a5079c838aa341e66a21a372235da54cf">sd_import_file_addresses</a> (void)</td></tr>
<tr class="memdesc:a5079c838aa341e66a21a372235da54cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">This reads the file address lookup table from the SD card generated by <a class="el" href="microsd_8c.html#a60c4323f06ff8dd8d4ade0dfc8b433ab" title="This does a brute force procedural search of the SD card looking for file identifiers....">sd_search_file_addresses()</a> and stores each address in its corresponding <a class="el" href="structt__sd__file.html">t_sd_file</a> structure.  <a href="microsd_8c.html#a5079c838aa341e66a21a372235da54cf">More...</a><br /></td></tr>
<tr class="separator:a5079c838aa341e66a21a372235da54cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb802230b9c4a776a397f284994afc31"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#adb802230b9c4a776a397f284994afc31">sd_parse_wav_header</a> (uint32_t tmp_address)</td></tr>
<tr class="memdesc:adb802230b9c4a776a397f284994afc31"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the header, contained in the first block, of a WAV file and return its file size in blocks.  <a href="microsd_8c.html#adb802230b9c4a776a397f284994afc31">More...</a><br /></td></tr>
<tr class="separator:adb802230b9c4a776a397f284994afc31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab208153b0bd50814e694ac84d776390d"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#ab208153b0bd50814e694ac84d776390d">microsd_init</a> (void)</td></tr>
<tr class="memdesc:ab208153b0bd50814e694ac84d776390d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the MCU's gpio, defines transfer settings and does the initial handshake with the SD card.  <a href="microsd_8c.html#ab208153b0bd50814e694ac84d776390d">More...</a><br /></td></tr>
<tr class="separator:ab208153b0bd50814e694ac84d776390d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87d9cbd1ac116f4b6a8b7e5e61c5541c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a87d9cbd1ac116f4b6a8b7e5e61c5541c">sd_read_block</a> (uint8_t *p_read_buffer, uint32_t block_address)</td></tr>
<tr class="memdesc:a87d9cbd1ac116f4b6a8b7e5e61c5541c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a single block (512bytes for SDHC) from the SD card.  <a href="microsd_8c.html#a87d9cbd1ac116f4b6a8b7e5e61c5541c">More...</a><br /></td></tr>
<tr class="separator:a87d9cbd1ac116f4b6a8b7e5e61c5541c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9a74a1644a78a1222d04dc1cd3bab3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#ae9a74a1644a78a1222d04dc1cd3bab3f">sd_write_block</a> (uint8_t *tmp_write_buffer, uint32_t block_address)</td></tr>
<tr class="memdesc:ae9a74a1644a78a1222d04dc1cd3bab3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a single block (512bytes for SDHC) to the SD card.  <a href="microsd_8c.html#ae9a74a1644a78a1222d04dc1cd3bab3f">More...</a><br /></td></tr>
<tr class="separator:ae9a74a1644a78a1222d04dc1cd3bab3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabf0c8d262bf6e00631aee9c9fb8425d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#aabf0c8d262bf6e00631aee9c9fb8425d">sd_print_block</a> (uint64_t block_address)</td></tr>
<tr class="memdesc:aabf0c8d262bf6e00631aee9c9fb8425d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a single block (512bytes for SDHC) from the SD card and send it over uart.  <a href="microsd_8c.html#aabf0c8d262bf6e00631aee9c9fb8425d">More...</a><br /></td></tr>
<tr class="separator:aabf0c8d262bf6e00631aee9c9fb8425d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac38f95e016ba3c259444ea6057d26749"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#ac38f95e016ba3c259444ea6057d26749">sd_read_multiple_block</a> (uint32_t start_address)</td></tr>
<tr class="memdesc:ac38f95e016ba3c259444ea6057d26749"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tell the SD card to continue sending data until told to stop.  <a href="microsd_8c.html#ac38f95e016ba3c259444ea6057d26749">More...</a><br /></td></tr>
<tr class="separator:ac38f95e016ba3c259444ea6057d26749"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05491b0286b988ffbe2ea66501c20b39"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a05491b0286b988ffbe2ea66501c20b39">sd_find_file_address</a> (const uint8_t *file_identifier)</td></tr>
<tr class="memdesc:a05491b0286b988ffbe2ea66501c20b39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the address of a particular file within the sd card.  <a href="microsd_8c.html#a05491b0286b988ffbe2ea66501c20b39">More...</a><br /></td></tr>
<tr class="separator:a05491b0286b988ffbe2ea66501c20b39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60c4323f06ff8dd8d4ade0dfc8b433ab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a60c4323f06ff8dd8d4ade0dfc8b433ab">sd_search_file_addresses</a> (void)</td></tr>
<tr class="memdesc:a60c4323f06ff8dd8d4ade0dfc8b433ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">This does a brute force procedural search of the SD card looking for file identifiers. It then copies the start addresses of each file to a lookup table in the SD card itself at a memory block very far outside of the scope that the FAT32 file system should ever manipulate for this system.  <a href="microsd_8c.html#a60c4323f06ff8dd8d4ade0dfc8b433ab">More...</a><br /></td></tr>
<tr class="separator:a60c4323f06ff8dd8d4ade0dfc8b433ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7347f6416271f90083729f31e9404f6a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a7347f6416271f90083729f31e9404f6a">sd_append_file_addresses</a> (<a class="el" href="enum__sd__file__list_8h.html#abfc1f2aa4fe589c3e54d42165e7f3daa">e_sd_address</a> start_address, <a class="el" href="enum__sd__file__list_8h.html#abfc1f2aa4fe589c3e54d42165e7f3daa">e_sd_address</a> stop_address)</td></tr>
<tr class="memdesc:a7347f6416271f90083729f31e9404f6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This does a brute force procedural search of the SD card looking for file identifiers. It then copies the start addresses of each file and appends them to the end of the lookup table in the SD card itself, starting at the input file number at a memory block very far outside of the scope that the FAT32 file system should ever manipulate for this system.  <a href="microsd_8c.html#a7347f6416271f90083729f31e9404f6a">More...</a><br /></td></tr>
<tr class="separator:a7347f6416271f90083729f31e9404f6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ebb6b34b03fbcd0e073a00957fb0e82"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a6ebb6b34b03fbcd0e073a00957fb0e82">sd_get_file_addresses</a> (uint32_t *tmp_file_list)</td></tr>
<tr class="memdesc:a6ebb6b34b03fbcd0e073a00957fb0e82"><td class="mdescLeft">&#160;</td><td class="mdescRight">This reads each file from its corresponding <a class="el" href="structt__sd__file.html">t_sd_file</a> structure and stores the addresses in an input buffer.  <a href="microsd_8c.html#a6ebb6b34b03fbcd0e073a00957fb0e82">More...</a><br /></td></tr>
<tr class="separator:a6ebb6b34b03fbcd0e073a00957fb0e82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55f76624d0e22b3ba58e5a758dbfc682"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a55f76624d0e22b3ba58e5a758dbfc682">sd_get_wav_size</a> (uint8_t tmp_file)</td></tr>
<tr class="memdesc:a55f76624d0e22b3ba58e5a758dbfc682"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the file size of the current file in blocks.  <a href="microsd_8c.html#a55f76624d0e22b3ba58e5a758dbfc682">More...</a><br /></td></tr>
<tr class="separator:a55f76624d0e22b3ba58e5a758dbfc682"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a761debcd3ea30139e78f32a7016bf454"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8c.html#a761debcd3ea30139e78f32a7016bf454">sd_stop_transmission</a> (void)</td></tr>
<tr class="memdesc:a761debcd3ea30139e78f32a7016bf454"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tell the SD card to stop transmitting data, aka stop MULTIPLE_BLOCK_READ.  <a href="microsd_8c.html#a761debcd3ea30139e78f32a7016bf454">More...</a><br /></td></tr>
<tr class="separator:a761debcd3ea30139e78f32a7016bf454"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains drivers for interacting with an external microSD card through SPI. </p>
<dl class="section author"><dt>Author</dt><dd>Aaron Vorse </dd></dl>
<dl class="section date"><dt>Date</dt><dd>7/9/2020 @contact <a href="#" onclick="location.href='mai'+'lto:'+'aar'+'on'+'.vo'+'rs'+'e@e'+'mb'+'edd'+'ed'+'res'+'um'+'e.c'+'om'; return false;">aaron<span style="display: none;">.nosp@m.</span>.vor<span style="display: none;">.nosp@m.</span>se@em<span style="display: none;">.nosp@m.</span>bedd<span style="display: none;">.nosp@m.</span>edres<span style="display: none;">.nosp@m.</span>ume.<span style="display: none;">.nosp@m.</span>com</a></dd></dl>
<p>@LICENSE:</p>
<p>Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="ac9569e2a141c90182d9ef36d91af5970"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9569e2a141c90182d9ef36d91af5970">&#9670;&nbsp;</a></span>e_sd_file_type</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="microsd_8c.html#abaf7619c551d1fc468c7ab87526164a4">e_sd_file_type</a> <a class="el" href="microsd_8c.html#abaf7619c551d1fc468c7ab87526164a4">e_sd_file_type</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab289a99c10567325e1eee455dba68dbd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab289a99c10567325e1eee455dba68dbd">&#9670;&nbsp;</a></span>t_sd_file</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structt__sd__file.html">t_sd_file</a> <a class="el" href="structt__sd__file.html">t_sd_file</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="abaf7619c551d1fc468c7ab87526164a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abaf7619c551d1fc468c7ab87526164a4">&#9670;&nbsp;</a></span>e_sd_file_type</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="microsd_8c.html#abaf7619c551d1fc468c7ab87526164a4">e_sd_file_type</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="abaf7619c551d1fc468c7ab87526164a4aa1b04f3fe4c0de5a3dfbbbb0d80e5d67"></a>bmp_file&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abaf7619c551d1fc468c7ab87526164a4a1b6d82aa746d57bebea9a2ab69b07aef"></a>wav_file&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abaf7619c551d1fc468c7ab87526164a4aa4ad49413733f1020f51fc7e828af1a8"></a>txt_file&#160;</td><td class="fielddoc"></td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab208153b0bd50814e694ac84d776390d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab208153b0bd50814e694ac84d776390d">&#9670;&nbsp;</a></span>microsd_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t microsd_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the MCU's gpio, defines transfer settings and does the initial handshake with the SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>init_success if successful this will be 1, otherwise 0;</dd></dl>
<dl class="section note"><dt>Note</dt><dd>SPI2_CS is not hardware controlled and must be managed in software </dd></dl>

</div>
</div>
<a id="a7347f6416271f90083729f31e9404f6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7347f6416271f90083729f31e9404f6a">&#9670;&nbsp;</a></span>sd_append_file_addresses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_append_file_addresses </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="enum__sd__file__list_8h.html#abfc1f2aa4fe589c3e54d42165e7f3daa">e_sd_address</a>&#160;</td>
          <td class="paramname"><em>start_address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="enum__sd__file__list_8h.html#abfc1f2aa4fe589c3e54d42165e7f3daa">e_sd_address</a>&#160;</td>
          <td class="paramname"><em>stop_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This does a brute force procedural search of the SD card looking for file identifiers. It then copies the start addresses of each file and appends them to the end of the lookup table in the SD card itself, starting at the input file number at a memory block very far outside of the scope that the FAT32 file system should ever manipulate for this system. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">start_address</td><td>The address of the first file you wish to append in the SD card's lookup table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stop_address</td><td>The address of the last file you wish to append in the SD card's lookup table </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This is very slow yet more maintainable. The function only ever runs once before flashing the main binary just to put the addresses in the sd card. It doesn't even get included in the main binary, so speed is not a great concern. </dd></dl>

</div>
</div>
<a id="ad83001a0c814f5477acd51fba80de713"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad83001a0c814f5477acd51fba80de713">&#9670;&nbsp;</a></span>sd_cmd24_termination_sequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_cmd24_termination_sequence </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for SD to return correct responses after writing a single block. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>

</div>
</div>
<a id="a05491b0286b988ffbe2ea66501c20b39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05491b0286b988ffbe2ea66501c20b39">&#9670;&nbsp;</a></span>sd_find_file_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t sd_find_file_address </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>file_identifier</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds the address of a particular file within the sd card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">file_identifier</td><td>List of 5 bytes in the first block of the file used to locate it in the SD card </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>file_address</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Address is represented by each 512-byte block </dd></dl>

</div>
</div>
<a id="a6ebb6b34b03fbcd0e073a00957fb0e82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ebb6b34b03fbcd0e073a00957fb0e82">&#9670;&nbsp;</a></span>sd_get_file_addresses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_get_file_addresses </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>tmp_file_list</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This reads each file from its corresponding <a class="el" href="structt__sd__file.html">t_sd_file</a> structure and stores the addresses in an input buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function will only work after <a class="el" href="microsd_8c.html#a5079c838aa341e66a21a372235da54cf" title="This reads the file address lookup table from the SD card generated by sd_search_file_addresses() and...">sd_import_file_addresses()</a> has been called. Otherwise all addresses will be returned as their init values, "0" </dd></dl>

</div>
</div>
<a id="a55f76624d0e22b3ba58e5a758dbfc682"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55f76624d0e22b3ba58e5a758dbfc682">&#9670;&nbsp;</a></span>sd_get_wav_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t sd_get_wav_size </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>tmp_file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the file size of the current file in blocks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tmp_file</td><td>File number as defined in enum_sd_address_list.h </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>file_size Size of the desired WAV file</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Only WAV files are initialized with a size, all other types will return random, uninitialized values </dd></dl>

</div>
</div>
<a id="ad718d3881a88d048f4a1f6457d2bf8b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad718d3881a88d048f4a1f6457d2bf8b4">&#9670;&nbsp;</a></span>sd_idle_sequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t sd_idle_sequence </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Puts SD card into idle state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>command0_success Flag for command0 error, 0 = error, 1 = valid response and SD is in idle state </dd></dl>

</div>
</div>
<a id="a5079c838aa341e66a21a372235da54cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5079c838aa341e66a21a372235da54cf">&#9670;&nbsp;</a></span>sd_import_file_addresses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_import_file_addresses </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This reads the file address lookup table from the SD card generated by <a class="el" href="microsd_8c.html#a60c4323f06ff8dd8d4ade0dfc8b433ab" title="This does a brute force procedural search of the SD card looking for file identifiers....">sd_search_file_addresses()</a> and stores each address in its corresponding <a class="el" href="structt__sd__file.html">t_sd_file</a> structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE</dd></dl>
<p>NOTE This should be called upon system startup after SPI and the SD card have been initialized </p>

</div>
</div>
<a id="a66c0ff809386256d45eab52c8fe5fefb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66c0ff809386256d45eab52c8fe5fefb">&#9670;&nbsp;</a></span>sd_interface_condition_sequence()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t sd_interface_condition_sequence </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if SD is 2.0 and sets voltage to 3.3v. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>command8_success Flag for command0 error, 0 = error, 1 = valid response and SD is in idle state </dd></dl>

</div>
</div>
<a id="adb802230b9c4a776a397f284994afc31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb802230b9c4a776a397f284994afc31">&#9670;&nbsp;</a></span>sd_parse_wav_header()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t sd_parse_wav_header </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>tmp_address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read the header, contained in the first block, of a WAV file and return its file size in blocks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tmp_address</td><td>Address of the WAV file to be parsed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>tmp_file_size In blocks </dd></dl>

</div>
</div>
<a id="aabf0c8d262bf6e00631aee9c9fb8425d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabf0c8d262bf6e00631aee9c9fb8425d">&#9670;&nbsp;</a></span>sd_print_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_print_block </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>block_address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a single block (512bytes for SDHC) from the SD card and send it over uart. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">block_address</td><td>Address of desired block. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>block_address is the address of the entire 512-byte block, not each individual byte address For example, to read byte 520, you would set block_address = 1 (address starts at 0) </dd></dl>

</div>
</div>
<a id="a87d9cbd1ac116f4b6a8b7e5e61c5541c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87d9cbd1ac116f4b6a8b7e5e61c5541c">&#9670;&nbsp;</a></span>sd_read_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_read_block </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>p_read_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>block_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a single block (512bytes for SDHC) from the SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_read_buffer</td><td>Buffer used to store the block. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block_address</td><td>Address of desired block. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Buffer must be larger than 512 bytes or this function will write to memory out of bounds </dd>
<dd>
block_address is the address of the entire 512-byte block, not each individual byte address For example, to read byte 520, you would set block_address = 1 (address starts at 0) </dd></dl>

</div>
</div>
<a id="ac38f95e016ba3c259444ea6057d26749"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac38f95e016ba3c259444ea6057d26749">&#9670;&nbsp;</a></span>sd_read_multiple_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_read_multiple_block </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>start_address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tell the SD card to continue sending data until told to stop. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">start_address</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>start_address is the address of the entire 512-byte block, not each individual byte address For example, to read byte 520, you would set block_address = 1 (address starts at 0) </dd></dl>

</div>
</div>
<a id="a1a4b8de004d39a5a80924d7bd69154be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a4b8de004d39a5a80924d7bd69154be">&#9670;&nbsp;</a></span>sd_read_ocr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t sd_read_ocr </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if SD card is powered on, voltage is acceptable and. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>command58_success </dd></dl>

</div>
</div>
<a id="a4a82443f01cf78e7ea902f201f893e82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a82443f01cf78e7ea902f201f893e82">&#9670;&nbsp;</a></span>sd_receive_r1_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t sd_receive_r1_response </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Recieves R1 response from SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>r1_response Byte containing r1 response error information </dd></dl>

</div>
</div>
<a id="a8b1796af1b16e2ed0dc306a96a714a5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b1796af1b16e2ed0dc306a96a714a5a">&#9670;&nbsp;</a></span>sd_receive_r3_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_receive_r3_response </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>r3_response</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receives R3 response from SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This response returns SD card operating voltages, capacity and power up state </dd></dl>

</div>
</div>
<a id="ac86c235f84f8f94abf9ad7e737e76f1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac86c235f84f8f94abf9ad7e737e76f1a">&#9670;&nbsp;</a></span>sd_receive_r7_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_receive_r7_response </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>r7_response</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receives R7 response from SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>r7_response Byte containing r1 response error information </dd></dl>

</div>
</div>
<a id="a60c4323f06ff8dd8d4ade0dfc8b433ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60c4323f06ff8dd8d4ade0dfc8b433ab">&#9670;&nbsp;</a></span>sd_search_file_addresses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_search_file_addresses </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This does a brute force procedural search of the SD card looking for file identifiers. It then copies the start addresses of each file to a lookup table in the SD card itself at a memory block very far outside of the scope that the FAT32 file system should ever manipulate for this system. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This is very slow yet more maintainable. The function only ever runs once before flashing the main binary just to put the addresses in the sd card. It doesn't even get included in the main binary, so speed is not a great concern. </dd></dl>

</div>
</div>
<a id="a06ccd3cb71dd16d5b308643aaf4c88d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06ccd3cb71dd16d5b308643aaf4c88d8">&#9670;&nbsp;</a></span>sd_send_app_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_send_app_command </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tell the SD card that the next command will be an application specific command. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

</div>
</div>
<a id="a67d8e6949bffdbb7b8909aecabcbddc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67d8e6949bffdbb7b8909aecabcbddc7">&#9670;&nbsp;</a></span>sd_send_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_send_command </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends 5-byte command/data to the SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">command</td><td>6-bit SD card command </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>4-bytes of information corresponding to the command </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>

</div>
</div>
<a id="a5ed5401fcbcc2c66013ea9aefdbd4a16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ed5401fcbcc2c66013ea9aefdbd4a16">&#9670;&nbsp;</a></span>sd_send_operating_condition()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t sd_send_operating_condition </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Activates the SD card initialization process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>command_success Flag for command0 error, 0 = error, 1 = valid response </dd></dl>

</div>
</div>
<a id="a761debcd3ea30139e78f32a7016bf454"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a761debcd3ea30139e78f32a7016bf454">&#9670;&nbsp;</a></span>sd_stop_transmission()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_stop_transmission </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tell the SD card to stop transmitting data, aka stop MULTIPLE_BLOCK_READ. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">current_byte</td><td>How many bytes have already been read from the current block </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>

</div>
</div>
<a id="ae9a74a1644a78a1222d04dc1cd3bab3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9a74a1644a78a1222d04dc1cd3bab3f">&#9670;&nbsp;</a></span>sd_write_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_write_block </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>tmp_write_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>block_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a single block (512bytes for SDHC) to the SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tmp_write_buffer</td><td>Data that will be written to the sd card </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block_address</td><td>Address of desired block. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_74b6a3b63f61c160c0f14b7a283a4c9b.html">Firmware</a></li><li class="navelem"><a class="el" href="dir_6920784cec34a5f013a34dcb61a8e258.html">Embedded Resume Files</a></li><li class="navelem"><a class="el" href="microsd_8c.html">microsd.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
