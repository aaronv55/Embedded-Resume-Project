<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Embedded Resume Project Code Documentation: Firmware/Embedded Resume Files/microsd.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Favicon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Embedded Resume Project Code Documentation
   &#160;<span id="projectnumber">Version 1.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('microsd_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">microsd.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This file contains drivers for interacting with an external microSD card through SPI.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &quot;stm32f4xx.h&quot;</code><br />
<code>#include &quot;stm32f410rx.h&quot;</code><br />
<code>#include &quot;<a class="el" href="base__gpio__drivers_8h_source.html">base_gpio_drivers.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="spi_8h_source.html">spi.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timers_8h_source.html">timers.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="enum__sd__file__list_8h_source.html">enum_sd_file_list.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="uart_8h_source.html">uart.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="lcd_8h_source.html">lcd.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="personal__function__toolbox_8h_source.html">personal_function_toolbox.h</a>&quot;</code><br />
</div>
<p><a href="microsd_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad4cb80f440da540f3b5f2383d5421799"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#ad4cb80f440da540f3b5f2383d5421799">SD_TRANSMISSION_BIT</a>&#160;&#160;&#160;0x40</td></tr>
<tr class="separator:ad4cb80f440da540f3b5f2383d5421799"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b861e9dfdd3829356e4ed860049135c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a8b861e9dfdd3829356e4ed860049135c">SD_DUMMY_CRC</a>&#160;&#160;&#160;0x01</td></tr>
<tr class="separator:a8b861e9dfdd3829356e4ed860049135c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab282b93d7f1278c3a8ecefe9885538a8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#ab282b93d7f1278c3a8ecefe9885538a8">SD_CMD8_VHS_3v3</a>&#160;&#160;&#160;(0x01 &lt;&lt; 8)</td></tr>
<tr class="separator:ab282b93d7f1278c3a8ecefe9885538a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1de2b64e6b92ced5d449defbaf6b5d9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#ac1de2b64e6b92ced5d449defbaf6b5d9">SD_CMD8_CHECK_PATTERN</a>&#160;&#160;&#160;0xAA</td></tr>
<tr class="separator:ac1de2b64e6b92ced5d449defbaf6b5d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02d74d4c908d2790e6100450d1b28dc7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a02d74d4c908d2790e6100450d1b28dc7">SD_CMD8_DATA</a>&#160;&#160;&#160;(<a class="el" href="microsd_8h.html#ab282b93d7f1278c3a8ecefe9885538a8">SD_CMD8_VHS_3v3</a> | <a class="el" href="microsd_8h.html#ac1de2b64e6b92ced5d449defbaf6b5d9">SD_CMD8_CHECK_PATTERN</a>)</td></tr>
<tr class="separator:a02d74d4c908d2790e6100450d1b28dc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff511f73f82d9dacec0d6d09f52ada7e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#aff511f73f82d9dacec0d6d09f52ada7e">SD_CMD8_CRC</a>&#160;&#160;&#160;(0x86 | 0x01)</td></tr>
<tr class="separator:aff511f73f82d9dacec0d6d09f52ada7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6d1a1dddef83540f14a058817162ca6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#ae6d1a1dddef83540f14a058817162ca6">SD_ACMD41_DATA</a>&#160;&#160;&#160;(0x40 &lt;&lt; 24)</td></tr>
<tr class="separator:ae6d1a1dddef83540f14a058817162ca6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac3a7685c1319b0999e727b255371903"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#aac3a7685c1319b0999e727b255371903">SD_RESPONSE3_3V2_3V4</a>&#160;&#160;&#160;0X60</td></tr>
<tr class="separator:aac3a7685c1319b0999e727b255371903"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f3bde37daf1d42b3f8ed7ae1516ee43"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a5f3bde37daf1d42b3f8ed7ae1516ee43">SD_RESPONSE3_POWER_UP</a>&#160;&#160;&#160;0X80</td></tr>
<tr class="separator:a5f3bde37daf1d42b3f8ed7ae1516ee43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03faf727d35b279f1b10de0bf58008ba"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a03faf727d35b279f1b10de0bf58008ba">SD_RESPONSE3_CCS</a>&#160;&#160;&#160;0x40</td></tr>
<tr class="separator:a03faf727d35b279f1b10de0bf58008ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa4d5001d099980ac778356469da97b6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#aaa4d5001d099980ac778356469da97b6">SD_CMD17_TOKEN</a>&#160;&#160;&#160;0xFE</td></tr>
<tr class="separator:aaa4d5001d099980ac778356469da97b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06610d4fd6300711335cfcc38943a434"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a06610d4fd6300711335cfcc38943a434">SD_ADDRESS_CHEAT_SHEET</a>&#160;&#160;&#160;4000000</td></tr>
<tr class="separator:a06610d4fd6300711335cfcc38943a434"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a881acbfa282179ac64edc1e7903ba7b4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a881acbfa282179ac64edc1e7903ba7b4">SD_ADDRESS_LIST_OFFSET</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a881acbfa282179ac64edc1e7903ba7b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab208153b0bd50814e694ac84d776390d"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#ab208153b0bd50814e694ac84d776390d">microsd_init</a> (void)</td></tr>
<tr class="memdesc:ab208153b0bd50814e694ac84d776390d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the MCU's gpio, defines transfer settings and does the initial handshake with the SD card.  <a href="microsd_8h.html#ab208153b0bd50814e694ac84d776390d">More...</a><br /></td></tr>
<tr class="separator:ab208153b0bd50814e694ac84d776390d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87d9cbd1ac116f4b6a8b7e5e61c5541c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a87d9cbd1ac116f4b6a8b7e5e61c5541c">sd_read_block</a> (uint8_t *p_read_buffer, uint32_t block_address)</td></tr>
<tr class="memdesc:a87d9cbd1ac116f4b6a8b7e5e61c5541c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a single block (512bytes for SDHC) from the SD card.  <a href="microsd_8h.html#a87d9cbd1ac116f4b6a8b7e5e61c5541c">More...</a><br /></td></tr>
<tr class="separator:a87d9cbd1ac116f4b6a8b7e5e61c5541c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9a74a1644a78a1222d04dc1cd3bab3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#ae9a74a1644a78a1222d04dc1cd3bab3f">sd_write_block</a> (uint8_t *tmp_write_buffer, uint32_t block_address)</td></tr>
<tr class="memdesc:ae9a74a1644a78a1222d04dc1cd3bab3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a single block (512bytes for SDHC) to the SD card.  <a href="microsd_8h.html#ae9a74a1644a78a1222d04dc1cd3bab3f">More...</a><br /></td></tr>
<tr class="separator:ae9a74a1644a78a1222d04dc1cd3bab3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05491b0286b988ffbe2ea66501c20b39"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a05491b0286b988ffbe2ea66501c20b39">sd_find_file_address</a> (const uint8_t *file_identifier)</td></tr>
<tr class="memdesc:a05491b0286b988ffbe2ea66501c20b39"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finds the address of a particular file within the sd card.  <a href="microsd_8h.html#a05491b0286b988ffbe2ea66501c20b39">More...</a><br /></td></tr>
<tr class="separator:a05491b0286b988ffbe2ea66501c20b39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac38f95e016ba3c259444ea6057d26749"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#ac38f95e016ba3c259444ea6057d26749">sd_read_multiple_block</a> (uint32_t start_address)</td></tr>
<tr class="memdesc:ac38f95e016ba3c259444ea6057d26749"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tell the SD card to continue sending data until told to stop.  <a href="microsd_8h.html#ac38f95e016ba3c259444ea6057d26749">More...</a><br /></td></tr>
<tr class="separator:ac38f95e016ba3c259444ea6057d26749"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabf0c8d262bf6e00631aee9c9fb8425d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#aabf0c8d262bf6e00631aee9c9fb8425d">sd_print_block</a> (uint64_t block_address)</td></tr>
<tr class="memdesc:aabf0c8d262bf6e00631aee9c9fb8425d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a single block (512bytes for SDHC) from the SD card and send it over uart.  <a href="microsd_8h.html#aabf0c8d262bf6e00631aee9c9fb8425d">More...</a><br /></td></tr>
<tr class="separator:aabf0c8d262bf6e00631aee9c9fb8425d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a761debcd3ea30139e78f32a7016bf454"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a761debcd3ea30139e78f32a7016bf454">sd_stop_transmission</a> (void)</td></tr>
<tr class="memdesc:a761debcd3ea30139e78f32a7016bf454"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tell the SD card to stop transmitting data, aka stop MULTIPLE_BLOCK_READ.  <a href="microsd_8h.html#a761debcd3ea30139e78f32a7016bf454">More...</a><br /></td></tr>
<tr class="separator:a761debcd3ea30139e78f32a7016bf454"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60c4323f06ff8dd8d4ade0dfc8b433ab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a60c4323f06ff8dd8d4ade0dfc8b433ab">sd_search_file_addresses</a> (void)</td></tr>
<tr class="memdesc:a60c4323f06ff8dd8d4ade0dfc8b433ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">This does a brute force procedural search of the SD card looking for file identifiers. It then copies the start addresses of each file to a lookup table in the SD card itself at a memory block very far outside of the scope that the FAT32 file system should ever manipulate for this system.  <a href="microsd_8h.html#a60c4323f06ff8dd8d4ade0dfc8b433ab">More...</a><br /></td></tr>
<tr class="separator:a60c4323f06ff8dd8d4ade0dfc8b433ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ebb6b34b03fbcd0e073a00957fb0e82"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a6ebb6b34b03fbcd0e073a00957fb0e82">sd_get_file_addresses</a> (uint32_t *tmp_file_list)</td></tr>
<tr class="memdesc:a6ebb6b34b03fbcd0e073a00957fb0e82"><td class="mdescLeft">&#160;</td><td class="mdescRight">This reads each file from its corresponding <a class="el" href="structt__sd__file.html">t_sd_file</a> structure and stores the addresses in an input buffer.  <a href="microsd_8h.html#a6ebb6b34b03fbcd0e073a00957fb0e82">More...</a><br /></td></tr>
<tr class="separator:a6ebb6b34b03fbcd0e073a00957fb0e82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7347f6416271f90083729f31e9404f6a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a7347f6416271f90083729f31e9404f6a">sd_append_file_addresses</a> (<a class="el" href="enum__sd__file__list_8h.html#abfc1f2aa4fe589c3e54d42165e7f3daa">e_sd_address</a> start_address, <a class="el" href="enum__sd__file__list_8h.html#abfc1f2aa4fe589c3e54d42165e7f3daa">e_sd_address</a> stop_address)</td></tr>
<tr class="memdesc:a7347f6416271f90083729f31e9404f6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">This does a brute force procedural search of the SD card looking for file identifiers. It then copies the start addresses of each file and appends them to the end of the lookup table in the SD card itself, starting at the input file number at a memory block very far outside of the scope that the FAT32 file system should ever manipulate for this system.  <a href="microsd_8h.html#a7347f6416271f90083729f31e9404f6a">More...</a><br /></td></tr>
<tr class="separator:a7347f6416271f90083729f31e9404f6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55f76624d0e22b3ba58e5a758dbfc682"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="microsd_8h.html#a55f76624d0e22b3ba58e5a758dbfc682">sd_get_wav_size</a> (uint8_t tmp_file)</td></tr>
<tr class="memdesc:a55f76624d0e22b3ba58e5a758dbfc682"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the file size of the current file in blocks.  <a href="microsd_8h.html#a55f76624d0e22b3ba58e5a758dbfc682">More...</a><br /></td></tr>
<tr class="separator:a55f76624d0e22b3ba58e5a758dbfc682"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file contains drivers for interacting with an external microSD card through SPI. </p>
<dl class="section author"><dt>Author</dt><dd>Aaron Vorse </dd></dl>
<dl class="section date"><dt>Date</dt><dd>7/9/2020 @contact <a href="#" onclick="location.href='mai'+'lto:'+'aar'+'on'+'.vo'+'rs'+'e@e'+'mb'+'edd'+'ed'+'res'+'um'+'e.c'+'om'; return false;">aaron<span style="display: none;">.nosp@m.</span>.vor<span style="display: none;">.nosp@m.</span>se@em<span style="display: none;">.nosp@m.</span>bedd<span style="display: none;">.nosp@m.</span>edres<span style="display: none;">.nosp@m.</span>ume.<span style="display: none;">.nosp@m.</span>com</a></dd></dl>
<p>@LICENSE:</p>
<p>Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae6d1a1dddef83540f14a058817162ca6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6d1a1dddef83540f14a058817162ca6">&#9670;&nbsp;</a></span>SD_ACMD41_DATA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_ACMD41_DATA&#160;&#160;&#160;(0x40 &lt;&lt; 24)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a06610d4fd6300711335cfcc38943a434"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06610d4fd6300711335cfcc38943a434">&#9670;&nbsp;</a></span>SD_ADDRESS_CHEAT_SHEET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_ADDRESS_CHEAT_SHEET&#160;&#160;&#160;4000000</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a881acbfa282179ac64edc1e7903ba7b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a881acbfa282179ac64edc1e7903ba7b4">&#9670;&nbsp;</a></span>SD_ADDRESS_LIST_OFFSET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_ADDRESS_LIST_OFFSET&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aaa4d5001d099980ac778356469da97b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa4d5001d099980ac778356469da97b6">&#9670;&nbsp;</a></span>SD_CMD17_TOKEN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_CMD17_TOKEN&#160;&#160;&#160;0xFE</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ac1de2b64e6b92ced5d449defbaf6b5d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1de2b64e6b92ced5d449defbaf6b5d9">&#9670;&nbsp;</a></span>SD_CMD8_CHECK_PATTERN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_CMD8_CHECK_PATTERN&#160;&#160;&#160;0xAA</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aff511f73f82d9dacec0d6d09f52ada7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff511f73f82d9dacec0d6d09f52ada7e">&#9670;&nbsp;</a></span>SD_CMD8_CRC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_CMD8_CRC&#160;&#160;&#160;(0x86 | 0x01)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a02d74d4c908d2790e6100450d1b28dc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02d74d4c908d2790e6100450d1b28dc7">&#9670;&nbsp;</a></span>SD_CMD8_DATA</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_CMD8_DATA&#160;&#160;&#160;(<a class="el" href="microsd_8h.html#ab282b93d7f1278c3a8ecefe9885538a8">SD_CMD8_VHS_3v3</a> | <a class="el" href="microsd_8h.html#ac1de2b64e6b92ced5d449defbaf6b5d9">SD_CMD8_CHECK_PATTERN</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab282b93d7f1278c3a8ecefe9885538a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab282b93d7f1278c3a8ecefe9885538a8">&#9670;&nbsp;</a></span>SD_CMD8_VHS_3v3</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_CMD8_VHS_3v3&#160;&#160;&#160;(0x01 &lt;&lt; 8)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8b861e9dfdd3829356e4ed860049135c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b861e9dfdd3829356e4ed860049135c">&#9670;&nbsp;</a></span>SD_DUMMY_CRC</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_DUMMY_CRC&#160;&#160;&#160;0x01</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aac3a7685c1319b0999e727b255371903"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac3a7685c1319b0999e727b255371903">&#9670;&nbsp;</a></span>SD_RESPONSE3_3V2_3V4</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_RESPONSE3_3V2_3V4&#160;&#160;&#160;0X60</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a03faf727d35b279f1b10de0bf58008ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03faf727d35b279f1b10de0bf58008ba">&#9670;&nbsp;</a></span>SD_RESPONSE3_CCS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_RESPONSE3_CCS&#160;&#160;&#160;0x40</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a5f3bde37daf1d42b3f8ed7ae1516ee43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f3bde37daf1d42b3f8ed7ae1516ee43">&#9670;&nbsp;</a></span>SD_RESPONSE3_POWER_UP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_RESPONSE3_POWER_UP&#160;&#160;&#160;0X80</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad4cb80f440da540f3b5f2383d5421799"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4cb80f440da540f3b5f2383d5421799">&#9670;&nbsp;</a></span>SD_TRANSMISSION_BIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SD_TRANSMISSION_BIT&#160;&#160;&#160;0x40</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab208153b0bd50814e694ac84d776390d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab208153b0bd50814e694ac84d776390d">&#9670;&nbsp;</a></span>microsd_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t microsd_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the MCU's gpio, defines transfer settings and does the initial handshake with the SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>init_success if successful this will be 1, otherwise 0;</dd></dl>
<dl class="section note"><dt>Note</dt><dd>SPI2_CS is not hardware controlled and must be managed in software </dd></dl>

</div>
</div>
<a id="a7347f6416271f90083729f31e9404f6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7347f6416271f90083729f31e9404f6a">&#9670;&nbsp;</a></span>sd_append_file_addresses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_append_file_addresses </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="enum__sd__file__list_8h.html#abfc1f2aa4fe589c3e54d42165e7f3daa">e_sd_address</a>&#160;</td>
          <td class="paramname"><em>start_address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="enum__sd__file__list_8h.html#abfc1f2aa4fe589c3e54d42165e7f3daa">e_sd_address</a>&#160;</td>
          <td class="paramname"><em>stop_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This does a brute force procedural search of the SD card looking for file identifiers. It then copies the start addresses of each file and appends them to the end of the lookup table in the SD card itself, starting at the input file number at a memory block very far outside of the scope that the FAT32 file system should ever manipulate for this system. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">start_address</td><td>The address of the first file you wish to append in the SD card's lookup table </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stop_address</td><td>The address of the last file you wish to append in the SD card's lookup table </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE</dd></dl>
<dl class="section note"><dt>Note</dt><dd>This is very slow yet more maintainable. The function only ever runs once before flashing the main binary just to put the addresses in the sd card. It doesn't even get included in the main binary, so speed is not a great concern. </dd></dl>

</div>
</div>
<a id="a05491b0286b988ffbe2ea66501c20b39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05491b0286b988ffbe2ea66501c20b39">&#9670;&nbsp;</a></span>sd_find_file_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t sd_find_file_address </td>
          <td>(</td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>file_identifier</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finds the address of a particular file within the sd card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">file_identifier</td><td>List of 5 bytes in the first block of the file used to locate it in the SD card </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>file_address</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Address is represented by each 512-byte block </dd></dl>

</div>
</div>
<a id="a6ebb6b34b03fbcd0e073a00957fb0e82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ebb6b34b03fbcd0e073a00957fb0e82">&#9670;&nbsp;</a></span>sd_get_file_addresses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_get_file_addresses </td>
          <td>(</td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>tmp_file_list</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This reads each file from its corresponding <a class="el" href="structt__sd__file.html">t_sd_file</a> structure and stores the addresses in an input buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This function will only work after <a class="el" href="microsd_8c.html#a5079c838aa341e66a21a372235da54cf" title="This reads the file address lookup table from the SD card generated by sd_search_file_addresses() and...">sd_import_file_addresses()</a> has been called. Otherwise all addresses will be returned as their init values, "0" </dd></dl>

</div>
</div>
<a id="a55f76624d0e22b3ba58e5a758dbfc682"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55f76624d0e22b3ba58e5a758dbfc682">&#9670;&nbsp;</a></span>sd_get_wav_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t sd_get_wav_size </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>tmp_file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the file size of the current file in blocks. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tmp_file</td><td>File number as defined in enum_sd_address_list.h </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>file_size Size of the desired WAV file</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Only WAV files are initialized with a size, all other types will return random, uninitialized values </dd></dl>

</div>
</div>
<a id="aabf0c8d262bf6e00631aee9c9fb8425d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabf0c8d262bf6e00631aee9c9fb8425d">&#9670;&nbsp;</a></span>sd_print_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_print_block </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>block_address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a single block (512bytes for SDHC) from the SD card and send it over uart. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">block_address</td><td>Address of desired block. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>block_address is the address of the entire 512-byte block, not each individual byte address For example, to read byte 520, you would set block_address = 1 (address starts at 0) </dd></dl>

</div>
</div>
<a id="a87d9cbd1ac116f4b6a8b7e5e61c5541c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87d9cbd1ac116f4b6a8b7e5e61c5541c">&#9670;&nbsp;</a></span>sd_read_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_read_block </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>p_read_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>block_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a single block (512bytes for SDHC) from the SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">p_read_buffer</td><td>Buffer used to store the block. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block_address</td><td>Address of desired block. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Buffer must be larger than 512 bytes or this function will write to memory out of bounds </dd>
<dd>
block_address is the address of the entire 512-byte block, not each individual byte address For example, to read byte 520, you would set block_address = 1 (address starts at 0) </dd></dl>

</div>
</div>
<a id="ac38f95e016ba3c259444ea6057d26749"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac38f95e016ba3c259444ea6057d26749">&#9670;&nbsp;</a></span>sd_read_multiple_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_read_multiple_block </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>start_address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tell the SD card to continue sending data until told to stop. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">start_address</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>start_address is the address of the entire 512-byte block, not each individual byte address For example, to read byte 520, you would set block_address = 1 (address starts at 0) </dd></dl>

</div>
</div>
<a id="a60c4323f06ff8dd8d4ade0dfc8b433ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60c4323f06ff8dd8d4ade0dfc8b433ab">&#9670;&nbsp;</a></span>sd_search_file_addresses()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_search_file_addresses </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This does a brute force procedural search of the SD card looking for file identifiers. It then copies the start addresses of each file to a lookup table in the SD card itself at a memory block very far outside of the scope that the FAT32 file system should ever manipulate for this system. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">NONE</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>
<dl class="section note"><dt>Note</dt><dd>This is very slow yet more maintainable. The function only ever runs once before flashing the main binary just to put the addresses in the sd card. It doesn't even get included in the main binary, so speed is not a great concern. </dd></dl>

</div>
</div>
<a id="a761debcd3ea30139e78f32a7016bf454"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a761debcd3ea30139e78f32a7016bf454">&#9670;&nbsp;</a></span>sd_stop_transmission()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_stop_transmission </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tell the SD card to stop transmitting data, aka stop MULTIPLE_BLOCK_READ. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">current_byte</td><td>How many bytes have already been read from the current block </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>

</div>
</div>
<a id="ae9a74a1644a78a1222d04dc1cd3bab3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9a74a1644a78a1222d04dc1cd3bab3f">&#9670;&nbsp;</a></span>sd_write_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sd_write_block </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>tmp_write_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>block_address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a single block (512bytes for SDHC) to the SD card. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tmp_write_buffer</td><td>Data that will be written to the sd card </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block_address</td><td>Address of desired block. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NONE </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_74b6a3b63f61c160c0f14b7a283a4c9b.html">Firmware</a></li><li class="navelem"><a class="el" href="dir_6920784cec34a5f013a34dcb61a8e258.html">Embedded Resume Files</a></li><li class="navelem"><a class="el" href="microsd_8h.html">microsd.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
